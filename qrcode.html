<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§§ æ–°æ˜¥è³“æœ â€” QR Code åˆ†äº«</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=ZCOOL+KuaiLe&display=swap');

:root {
  --red: #C41E1E;
  --red-dark: #7A0000;
  --red-deep: #520000;
  --gold: #F0C040;
  --gold-bright: #FFD700;
  --cream: #FFF8E8;
  --ink: #1A0505;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Noto Sans TC', sans-serif;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background:
    radial-gradient(ellipse at 30% 20%, rgba(240,192,64,0.08) 0%, transparent 50%),
    linear-gradient(175deg, #520000 0%, #7A0000 35%, #520000 70%, #3A0000 100%);
  padding: 20px;
}

.card {
  background: linear-gradient(160deg, rgba(255,248,232,0.97), rgba(245,230,200,0.94));
  border: 3px solid var(--gold);
  border-radius: 28px;
  padding: 40px 32px;
  max-width: 440px;
  width: 100%;
  text-align: center;
  box-shadow: 0 10px 60px rgba(0,0,0,0.4), 0 0 80px rgba(240,192,64,0.1);
  color: var(--ink);
  animation: cardUp 0.6s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes cardUp {
  from { opacity: 0; transform: translateY(30px) scale(0.95); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.header-emoji { font-size: 2.5rem; margin-bottom: 6px; }

h1 {
  font-family: 'ZCOOL KuaiLe', cursive;
  font-size: 1.8rem;
  color: var(--red);
  margin-bottom: 4px;
}

.subtitle {
  font-size: 0.82rem;
  color: var(--red-dark);
  opacity: 0.6;
  margin-bottom: 24px;
}

.input-row {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
}

.input-row input {
  flex: 1;
  padding: 13px 15px;
  border: 2px solid rgba(196,30,30,0.18);
  border-radius: 13px;
  font-family: 'Noto Sans TC', sans-serif;
  font-size: 0.95rem;
  background: rgba(255,255,255,0.7);
  color: var(--ink);
  outline: none;
  transition: border-color 0.2s;
}
.input-row input:focus { border-color: var(--gold); }

.input-row button {
  padding: 13px 20px;
  background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%);
  color: var(--gold-bright);
  border: 2px solid var(--gold);
  border-radius: 13px;
  font-family: 'Noto Sans TC', sans-serif;
  font-size: 0.9rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}
.input-row button:hover { transform: translateY(-1px); }
.input-row button:active { transform: scale(0.97); }

/* QR container */
.qr-wrap {
  display: inline-block;
  background: white;
  padding: 20px;
  border-radius: 18px;
  border: 3px solid var(--gold);
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  margin-bottom: 16px;
}
.qr-wrap canvas, .qr-wrap img { border-radius: 4px; }

.url-display {
  font-size: 0.78rem;
  color: var(--red-dark);
  opacity: 0.6;
  word-break: break-all;
  margin-bottom: 20px;
  padding: 10px 14px;
  background: rgba(196,30,30,0.05);
  border-radius: 10px;
}

.actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

.action-btn {
  padding: 11px 22px;
  border-radius: 24px;
  font-family: 'Noto Sans TC', sans-serif;
  font-size: 0.85rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  border: 2px solid var(--gold);
  text-decoration: none;
}
.action-btn:hover { transform: translateY(-1px); }
.action-btn.primary {
  background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%);
  color: var(--gold-bright);
}
.action-btn.secondary {
  background: rgba(255,255,255,0.5);
  color: var(--red-dark);
}

.print-hint {
  margin-top: 20px;
  font-size: 0.72rem;
  color: var(--red-dark);
  opacity: 0.45;
}

/* Print styles */
@media print {
  body { background: white !important; }
  .card {
    box-shadow: none;
    border: 2px solid #ccc;
    max-width: 100%;
  }
  .input-row, .actions, .print-hint { display: none !important; }
  .qr-wrap { border: 2px solid #ddd; }
}
</style>
</head>
<body>

<div class="card">
  <div class="header-emoji">ğŸ®ğŸ§§ğŸ®</div>
  <h1>è€é ‘ç«¥å®¶æ— è³“æœå¤§æ¨‚é€</h1>
  <div class="subtitle">æƒæ QR Code åŠ å…¥éŠæˆ²ï¼<br><small style="font-size:0.75rem;opacity:0.7;">ï¼ˆç·šä¸Šæ¨¡å¼è«‹åœ¨éŠæˆ²å…§åˆ†äº«æˆ¿é–“ç¢¼ï¼‰</small></div>

  <div class="input-row">
    <input type="text" id="urlInput" value="" placeholder="è¼¸å…¥ä½ çš„ GitHub Pages ç¶²å€">
    <button onclick="generateQR()">ç”Ÿæˆ</button>
  </div>

  <div class="qr-wrap" id="qrWrap">
    <div id="qrcode" style="width:220px;height:220px;display:flex;align-items:center;justify-content:center;">
      <span style="color:#bbb;font-size:0.85rem;">â† è¼¸å…¥ç¶²å€å¾Œé»ã€Œç”Ÿæˆã€</span>
    </div>
  </div>

  <div class="url-display" id="urlDisplay" style="display:none;"></div>

  <div class="actions">
    <a class="action-btn primary" id="playLink" href="#" target="_blank">ğŸ® ç›´æ¥é–‹å§‹ç©</a>
    <button class="action-btn secondary" onclick="downloadQR()">ğŸ“¥ ä¸‹è¼‰ QR Code</button>
    <button class="action-btn secondary" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
  </div>

  <div class="print-hint">
    ğŸ’¡ å¯ä»¥åˆ—å°é€™é è²¼åœ¨å®¢å»³ï¼Œè®“ä¾†æ‹œå¹´çš„è¦ªå‹æƒç¢¼ä¸€èµ·ç©ï¼
  </div>
</div>

<script>
let qrInstance = null;

// Auto-detect URL: if hosted on GitHub Pages, use current origin
function detectURL() {
  const loc = window.location;
  // If we're on github.io, construct the game URL
  if (loc.hostname.includes('github.io')) {
    const pathParts = loc.pathname.split('/').filter(Boolean);
    // e.g. /cny-bingo/qrcode.html â†’ /cny-bingo/
    if (pathParts.length > 0) {
      return `${loc.origin}/${pathParts[0]}/`;
    }
    return loc.origin + '/';
  }
  return '';
}

function init() {
  const detected = detectURL();
  const input = document.getElementById('urlInput');
  if (detected) {
    input.value = detected;
    generateQR();
  } else {
    input.value = '';
    input.placeholder = 'ä¾‹ï¼šhttps://yourname.github.io/cny-bingo/';
  }
}

function generateQR() {
  let url = document.getElementById('urlInput').value.trim();
  if (!url) { alert('è«‹è¼¸å…¥éŠæˆ²ç¶²å€'); return; }

  // Ensure trailing slash and point to index
  if (!url.endsWith('/') && !url.endsWith('.html')) url += '/';

  const container = document.getElementById('qrcode');
  container.innerHTML = '';

  qrInstance = new QRCode(container, {
    text: url,
    width: 220,
    height: 220,
    colorDark: '#520000',
    colorLight: '#FFFFFF',
    correctLevel: QRCode.CorrectLevel.H
  });

  document.getElementById('urlDisplay').textContent = url;
  document.getElementById('urlDisplay').style.display = 'block';
  document.getElementById('playLink').href = url;
}

function downloadQR() {
  const canvas = document.querySelector('#qrcode canvas');
  if (!canvas) { alert('è«‹å…ˆç”Ÿæˆ QR Code'); return; }

  // Create a larger canvas with decorative border
  const size = 400;
  const pad = 40;
  const c = document.createElement('canvas');
  c.width = size + pad * 2;
  c.height = size + pad * 2 + 70;
  const ctx = c.getContext('2d');

  // Background
  ctx.fillStyle = '#FFF8E8';
  ctx.fillRect(0, 0, c.width, c.height);

  // Gold border
  ctx.strokeStyle = '#F0C040';
  ctx.lineWidth = 4;
  ctx.roundRect(8, 8, c.width - 16, c.height - 16, 16);
  ctx.stroke();

  // QR code
  ctx.drawImage(canvas, pad, pad, size, size);

  // Text
  ctx.fillStyle = '#520000';
  ctx.font = 'bold 18px "Noto Sans TC", sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('ğŸ§§ è€é ‘ç«¥å®¶æ— è³“æœå¤§æ¨‚é€ ğŸ§§', c.width / 2, size + pad + 35);
  ctx.font = '12px "Noto Sans TC", sans-serif';
  ctx.fillStyle = '#7A0000';
  ctx.fillText('æƒæåŠ å…¥éŠæˆ²', c.width / 2, size + pad + 58);

  // Download
  const link = document.createElement('a');
  link.download = 'cny-bingo-qrcode.png';
  link.href = c.toDataURL('image/png');
  link.click();
}

// CanvasRenderingContext2D.roundRect polyfill
if (!CanvasRenderingContext2D.prototype.roundRect) {
  CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
    this.beginPath();
    this.moveTo(x + r, y);
    this.lineTo(x + w - r, y);
    this.quadraticCurveTo(x + w, y, x + w, y + r);
    this.lineTo(x + w, y + h - r);
    this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
    this.lineTo(x + r, y + h);
    this.quadraticCurveTo(x, y + h, x, y + h - r);
    this.lineTo(x, y + r);
    this.quadraticCurveTo(x, y, x + r, y);
    this.closePath();
  };
}

// Enter key
document.getElementById('urlInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') generateQR();
});

init();
</script>

</body>
</html>
